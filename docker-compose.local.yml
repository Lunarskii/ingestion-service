# docker-compose.local.yml — локальная конфигурация для разработки / тестирования Qdrant + MinIO
# Этот файл использует **bind mounts** — данные будут храниться в указанных папках на хосте.
# Использование: docker compose -f docker-compose.local.yml up -d

# Примечания по персистентности данных
# - В этой конфигурации данные будут храниться на хосте в:
#     Qdrant: ./qdrant
#     MinIO: ./minio
# - Создайте эти директории на хосте до запуска и установите корректные права:
#     sudo mkdir ./qdrant ./minio
#     sudo chown $(id -u):$(id -g) /usr/local/share/qdrant /usr/local/share/minio
# - Это даст вашему текущему пользователю права на эти папки; при необходимости настройте иначе.

services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant_local
    ports:
      - "6333:6333" # HTTP API
      - "6334:6334" # gRPC API
    volumes:
      - ./qdrant:/qdrant/storage
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6333/collections"]
      interval: 30s
      timeout: 10s
      retries: 3

  minio:
    image: minio/minio:latest
    container_name: minio_local
    ports:
      - "9000:9000" # S3 API
      - "9001:9001" # S3 UI
    environment:
      MINIO_ROOT_USER: "${MINIO_ROOT_USER:-access_key}"
      MINIO_ROOT_PASSWORD: "${MINIO_ROOT_PASSWORD:-secret_key}"
      MINIO_COMPRESSION_ENABLE: "${MINIO_COMPRESSION_ENABLE:-on}"
      MINIO_COMPRESSION_EXTENSIONS: "${MINIO_COMPRESSION_EXTENSIONS:-.pdf}"
      MINIO_COMPRESSION_MIME_TYPES: "${MINIO_COMPRESSION_MIME_TYPES:-application/pdf}"
    volumes:
      - ./minio:/data
    command: server /data --address ":9000" --console-address ":9001"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://127.0.0.1:9000/minio/health/ready || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
